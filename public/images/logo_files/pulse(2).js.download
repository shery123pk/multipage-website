(()=>{"use strict";class InjectionToken{constructor(e){if(this.key=e,"string"!=typeof e||!e.trim())throw new Error("Invalid InjectionToken name!");this.___=e}}const e=new InjectionToken("Window"),t=(new InjectionToken("PERF_HOOKS"),new InjectionToken("PULSE_GLOBALS"),new InjectionToken("STORAGE_SELECTOR")),r=new InjectionToken("DATA_LAYER"),n=new InjectionToken("INTERNAL_DATA_LAYER"),i=new InjectionToken("PULSE_ROOT_CONFIGURATION");class AsyncTask{constructor(e){if(this.completed=!1,this.task=new Promise(((e,t)=>{this.resolveTask=e,this.rejectTask=t})),e){const t=setTimeout((()=>{this.reject(new Error(`AsyncTask timeout after ${e}ms!`))}),e);this.waitUntilResolved().then((()=>clearTimeout(t))).catch((()=>clearTimeout(t)))}}resolve(e){this.completed||(this.completed=!0,this.resolveTask(e))}reject(e){this.completed||(this.completed=!0,this.rejectTask(e))}waitUntilResolved(){return this.task}}class PulseInjector{constructor(e){this.parent=e,this.providers=new Map,this.store=new Map,this.tasks=new Map}register(...e){for(const t of e)this.providers.set(t.provide,t);return this}factory(e){return this.providers.set(e.provide,e),this}get(e){const t=this.getOrCreate(e);return this.isPromise(t)?t:Promise.resolve(t)}getSync(e){const t=this.getOrCreate(e);if(this.isPromise(t)){const t=this.typeName(e);throw new Error(["Cannot instantiate dependency synchronously!",`One of the providers of the dependencies of '${t}' is asynchronous!`].join("\n"))}return t}getOrCreate(e){if(e===PulseInjector)return this;const t=this.store.get(e);if(t)return t;let r=this.tasks.get(e);if(r)return r.waitUntilResolved();r=new AsyncTask;const n=this.providers.get(e);if(!n){if(this.parent)return this.parent.getOrCreate(e);throw new Error(`No provider found for type '${this.typeName(e)}'!`)}const i=this.getDeps(n);if(this.isPromise(i))return this.tasks.set(e,r),i.then((e=>this.createValue(n,e))).then((t=>{this.store.set(e,t),r?.resolve(t),this.tasks.delete(e)})).catch((t=>{this.tasks.delete(e),r?.reject(t)})),r.waitUntilResolved();{const t=this.createValue(n,i);return this.store.set(e,t),t}}createValue(e,t){if(void 0!==e.useValue)return e.useValue;if(e.useClass)return new e.useClass(...t);if(e.useFactory)return e.useFactory(...t);if(this.isClass(e.provide))return new e.provide(...t);{const t=this.typeName(e.provide);throw new Error(`No useClass or useFactory is provided for type '${t}'`)}}getDeps(e){this.checkDeps(e);const t=(Array.isArray(e.deps)?e.deps:[]).map((e=>this.getOrCreate(e))),r=t.some((e=>this.isPromise(e)));return r?Promise.all(t):t}checkDeps(e){const t=Array.isArray(e.deps)?e.deps:[],r=t.map((e=>this.findProvider(e))),n=t.filter(((e,t)=>void 0===r[t]));if(!n.length)return;const i=this.typeName(e.provide),o=r.map((e=>e?this.typeName(e.provide):"?")).join(", "),s=`No provider found for the following tokens: ${n.map((e=>this.typeName(e))).join(", ")}`;throw new Error(`Cannot instantiate dependency '${i}(${o})'!\n\n ${s}`)}findProvider(e){return this.providers.get(e)||this.parent?.findProvider(e)}typeName(e){return e instanceof InjectionToken?`Token(${e.key})`:this.isClass(e)?e.name:String(e)}isClass(e){return e&&"function"==typeof e&&"string"==typeof e.name&&"function"==typeof e.constructor&&e.name}isPromise(e){return"object"==typeof e&&(e instanceof Promise||e.then&&e.catch)}}class ProviderBuilder{constructor(){this.providers=[]}useClass(e,t,r,n){return this.providers.push({provide:e,useClass:t,deps:r,provideInRoot:n}),this}useFactory(e,t,r,n){return this.providers.push({provide:e,useFactory:t,deps:r,provideInRoot:n}),this}useValue(e,t,r){return this.providers.push({provide:e,useValue:t,provideInRoot:r}),this}_getProviders(){return this.providers}}class PulseModule{constructor(){this.imports=[],this.builder=new ProviderBuilder,this.injector=new PulseInjector,this.bootstrapped=!1}import(e){if(e.bootstrapped)throw new Error("Cannot import already bootstrapped module! Only root module must be bootstrapped!");return e.parent=this,this.imports.push(e),this}provide(e){const t=e(this.builder);if(!(t&&t instanceof ProviderBuilder))throw new Error("Provide function must return the received ProviderBuilder instance!");return this.builder=t,this}beforeInit(e){if("function"!=typeof e)throw new Error("BeforeInit handler must be a function!");return this.beforeInitHandler=e,this}onInit(e,t){if("function"!=typeof e)throw new Error("OnInit handler must be a function!");if(t&&!Array.isArray(t))throw new Error("OnInit handler dependency list must be an array!");return this.initHandler={provide:"initializer",useFactory:e,deps:t||void 0},this}bootstrapStrict(e){return this.bootstrap(e)}async bootstrap(e){if(this.bootstrapped)throw new Error("PulseModule is already bootstrapped!");if(this.bootstrapped)throw new Error("Cannot bootstrap child module!");if(this.imports.some((e=>e.bootstrapped)))throw new Error("Cannot import already bootstrapped module! Only root module must be bootstrapped!");const t=await this.runModulesBeforeInit(e),r=this.getConfigOverride(t),n={provide:i,useValue:r};return this.injector.register(n),await this.initializeModules(e),this.injector}getConfigOverride(e){try{if("undefined"!=typeof window&&window.localStorage?.getItem){const t=window.localStorage.getItem(`${e.storagePrefix}config_override`);if(t){const r=JSON.parse(t);return r&&"object"==typeof r?{...e,...r}:(console.error("Configuration entry must be an object!"),e)}}}catch(t){console.error("Pulse configuration provided through localStorage is invalid!")}return e}async initializeModules(e){const t=[...this.imports,this];for(const n of t)n.configureInjector();const r=t.map((t=>t.runOnInit(e)));await Promise.all(r)}configureInjector(){if(this.parent&&this.imports.length)throw new Error("Deep module imports are not supported yet!");const e=this.parent?.injector,t=e?new PulseInjector(e):this.injector,r=this.builder._getProviders(),n=r.filter((e=>!1!==e.provideInRoot)),i=r.filter((e=>!e.provideInRoot));t.register(...i),e?e.register(...n):n.length&&t.register(...n),this.injector=t}async runModulesBeforeInit(e){const t=await this.runBeforeInit(e),r=this.imports.map((t=>t.runBeforeInit(e)));return{...t,...(await Promise.all(r)).reduce(((e,t)=>({...e,...t})))}}async runBeforeInit(e){try{const t=this.beforeInitHandler?this.beforeInitHandler(e):void 0;return(t instanceof Promise?await t:t)||{}}catch(t){throw console.error("Module beforeInit hook failed!"),t}}async runOnInit(e){try{if(!this.initHandler?.useFactory)return;const t=(this.initHandler.deps||[]).map((e=>this.injector.get(e))),r=await Promise.all(t),n=this.initHandler.useFactory(e,...r);n instanceof Promise&&await n}catch(t){throw console.error(t),console.error("Module onInit hook failed!"),t}}}class PulseTracker{constructor(e,t,r,n,i,o,s,a){this.plugins=e,this.pipes=t,this.defaultPipes=r,this.logger=n,this.date=i,this.config=o,this.stateService=s,this.transportService=a;const c=this.getContext();e.init(c)}event(e){this.events([e])}events(e){this.processMessages("event",e)}set(e){"object"==typeof e&&e&&!Array.isArray(e)&&this.stateService.setState(e)}cmd(e,...t){if(Array.isArray(e))return this.cmd(e[0],...e.slice(1));const r=e.split("."),n=this[PulseTracker.commandMap.get(r[1]||r[0]||"")||r[0]||""];"function"==typeof n?n.apply(this,t):this.logger.warn("Tracker",`Analytics command '${e}' not found!`)}getContext(){return{config:this.config,tracker:this}}processMessages(e,t){const r=this.getContext(),n=t.map((t=>({type:e,data:JSON.parse(JSON.stringify(t)),state:{},timestamp:this.date.now()}))).flatMap((e=>this.pipes.transform(e,r).map((e=>this.defaultPipes.transform(e,r))).flat().map((e=>this.defaultPipes.enrich(e,r))).map((e=>this.pipes.enrich(e,r)))));this.transportService.send(n)}}PulseTracker.commandMap=new Map([["event","event"],["send","event"],["set","set"],["state","set"]]);const o=new InjectionToken("DEFAULT_PIPES_HOST_TOKEN"),s=new InjectionToken("PIPES_HOST_TOKEN");class DataLayerPlugin{constructor(e,t){this.dataLayer=e,this.commandPrefix=t}init(e){if(this.tracker=e.tracker,!Array.isArray(this.dataLayer))throw new Error("DataLayer must be an array!");this.defaultPush=this.dataLayer.push.bind(this.dataLayer),this.dataLayer.push=this.onPush.bind(this),this.readFromBeginning()}onPush(...e){for(const t of e)this.processItem(t);return this.defaultPush?this.defaultPush(...e):0}readFromBeginning(){for(const e of this.dataLayer)this.processItem(e)}processItem(e){if(!this.tracker||"object"!=typeof e||!e)return;const t=e;if(this.isCommand(e)){const t=Array.from(e);this.tracker.cmd(t)}else if("event"===e.pulse){const t=this.normalize(e);this.tracker.event(t)}else if("state"===e.pulse){const t=this.normalize(e);this.tracker.set(t)}else"custom_event"!==t.event&&"custom_event_non_interaction"!==t.event||this.tracker.event(t.data)}isCommand(e){return(Array.isArray(e)||"[object Arguments]"===Object.prototype.toString.call(e))&&"string"==typeof e[0]&&e[0].startsWith(this.commandPrefix)}normalize(e){const t={...e};return delete t.paa,t.pulse&&delete t.pulse,t}}class PluginsFactory{constructor(e,t,r,n,i,o,s,a,c,u){this.navigationEventPlugin=e,this.visibilityChangePlugin=t,this.clickEventPlugin=r,this.pluginHost=n,this.config=i,this.popupEventPlugin=o,this.internalDataLayer=s,this.rumPlugin=a,this.contextmenuPlugin=c,this.dataLayer=u}registerPlugins(){const e=[this.visibilityChangePlugin,this.clickEventPlugin,this.navigationEventPlugin,this.popupEventPlugin,this.rumPlugin,this.contextmenuPlugin,...this.config.plugins||[]];this.dataLayer&&e.push(new DataLayerPlugin(this.dataLayer,"paa.")),this.internalDataLayer&&Array.isArray(this.internalDataLayer)&&e.push(new DataLayerPlugin(this.internalDataLayer,"")),e.forEach((e=>this.pluginHost.register(e)))}}class PipesFactory{constructor(e,t,r,n,i){this.actionParamEventPipe=e,this.eventGlobalsPipe=t,this.pipesHost=r,this.defaultPipesHost=n,this.config=i}registerPipes(){const e=this.config.transformPipes||[],t=this.config.enrichmentPipes||[],r=[{selector:"event",use:[this.actionParamEventPipe]}],n=[{selector:"event",use:[this.eventGlobalsPipe]}];r.forEach((e=>this.defaultPipesHost.registerTransformSet(e))),n.forEach((e=>this.defaultPipesHost.registerEnrichmentSet(e))),e.forEach((e=>this.pipesHost.registerTransformSet(e))),t.forEach((e=>this.pipesHost.registerEnrichmentSet(e)))}}class AnalyticsEnvironment{constructor(e){this.win=e,this.doc=this.win.document,this.landingUrl=this.getInitialDocumentURL(),this.navigator=this.win.navigator}getInitialDocumentURL(){if("function"==typeof this.win.performance?.getEntries){const e=this.win.performance.getEntries().find((e=>"navigation"===e.entryType));if(e&&this.isValidURL(e.name))return e.name}return this.isValidURL(this.win.pulse?.idu)?this.win.pulse.idu:this.win.document.location.href}isValidURL(e){if("string"!=typeof e)return!1;try{return!!new URL(e).hostname}catch{return!1}}}class PipeHost{constructor(){this.transformPipes=[],this.enrichmentPipes=[]}process(e,t){return this.transform(e,t).map((e=>this.enrich(e,t)))}transform(e,t){const r=this.selectPipeSet(e,this.transformPipes);let n=[e];for(const i of r){if(!i.transform)continue;const e=[];for(const r of n){const n=i.transform(r,t);e.push(...n)}n=e}return n}enrich(e,t){return this.selectPipeSet(e,this.enrichmentPipes).reverse().reduce(((e,r)=>r.enrich(e,t)),e)}registerTransformSet(e){this.transformPipes.push(e)}registerEnrichmentSet(e){this.enrichmentPipes.push(e)}selectPipeSet(e,t){for(const r of t){if(!("*"===r.selector||r.selector===e.type||"function"==typeof r.selector&&r.selector(e)||!1))continue;if(!("function"==typeof r.exclude&&r.exclude(e)))return[...r.use]}return[]}}class EventGlobalsPipe{constructor(e){this.env=e,this.attributes=this.env.win?.pulse?._attributes}enrich(e){const t={...e.data,...this.attributes};return"object"==typeof t.data&&null!==t.data||(t.data={}),t.timestamp=e.timestamp,t.metadata={event_id_source:"mini_sdk"},e.data=t,e}}class ActionParamEventPipe{transform(e){const t={...e.data};return"string"==typeof t.event&&t.event||"string"!=typeof t.action||!t.action||(t.event=t.action,delete t.action),"object"==typeof t.data&&t.data||("object"==typeof t.parameters&&t.parameters?(t.data=t.parameters,delete t.parameters):t.data={}),e.data=t,[e]}}class PluginHost{constructor(){this.plugins=[]}init(e){this.plugins.forEach((t=>t.init&&t.init(e)))}register(e){this.plugins.push(e)}}class NavigationEventPlugin{constructor(e,t,r){this.historyTracker=e,this.navigationService=t,this.activitySynchronizer=r,this.initial=!0}init(){this.activitySynchronizer.startService(),this.historyTracker.navigation.subscribe((e=>{this.navigationService.send(this.initial,e),this.initial=!1}))}}var a;!function(e){e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden"}(a||(a={}));class VisibilityChangePlugin{constructor(e){this.visibility=e,this.visibilityState=a.Visible}init(){this.visibility.onVisibilityChange().subscribe((e=>{this.visibilityState=e?a.Visible:a.Hidden}))}}function c(e){return"function"==typeof e}function u(e){return function(t){if(function(e){return c(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(r){this.error(r)}}));throw new TypeError("Unable to lift unknown Observable type")}}var l=function(e,t){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},l(e,t)};function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function h(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(t){o(t)}}function a(e){try{c(n.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function d(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(c){a=[6,c],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function f(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(a){i={error:a}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function y(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function m(e){return this instanceof m?(this.v=e,this):new m(e)}function g(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||a(e,t)}))})}function a(e,t){try{(r=i[e](t)).value instanceof m?Promise.resolve(r.value.v).then(c,u):l(o[0][2],r)}catch(n){l(o[0][3],n)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function b(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=f(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}Object.create;function S(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var w=S((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function _(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var E=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=f(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(m){e={error:m}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(c(u))try{u()}catch(g){i=g instanceof w?g.errors:[g]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var p=f(l),h=p.next();!h.done;h=p.next()){var d=h.value;try{k(d)}catch(b){i=null!=i?i:[],b instanceof w?i=y(y([],v(i)),v(b.errors)):i.push(b)}}}catch(S){r={error:S}}finally{try{h&&!h.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}}if(i)throw new w(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)k(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&_(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&_(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),T=E.EMPTY;function P(e){return e instanceof E||e&&"closed"in e&&c(e.remove)&&c(e.add)&&c(e.unsubscribe)}function k(e){c(e)?e():e.unsubscribe()}var C={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},N={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=N.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,y([e,t],v(r))):setTimeout.apply(void 0,y([e,t],v(r)))},clearTimeout:function(e){var t=N.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function A(e){N.setTimeout((function(){var t=C.onUnhandledError;if(!t)throw e;t(e)}))}function x(){}var L=I("C",void 0,void 0);function I(e,t,r){return{kind:e,value:t,error:r}}var O=null;function R(e){if(C.useDeprecatedSynchronousErrorHandling){var t=!O;if(t&&(O={errorThrown:!1,error:null}),e(),t){var r=O,n=r.errorThrown,i=r.error;if(O=null,n)throw i}}else e()}var D=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,P(t)&&t.add(r)):r.destination=F,r}return p(t,e),t.create=function(e,t,r){return new V(e,t,r)},t.prototype.next=function(e){this.isStopped?B(function(e){return I("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?B(I("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?B(L,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(E),j=Function.prototype.bind;function M(e,t){return j.call(e,t)}var z=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){H(r)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){H(r)}else H(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){H(t)}},e}(),V=function(e){function t(t,r,n){var i,o,s=e.call(this)||this;c(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&C.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&M(t.next,o),error:t.error&&M(t.error,o),complete:t.complete&&M(t.complete,o)}):i=t;return s.destination=new z(i),s}return p(t,e),t}(D);function H(e){var t;C.useDeprecatedSynchronousErrorHandling?(t=e,C.useDeprecatedSynchronousErrorHandling&&O&&(O.errorThrown=!0,O.error=t)):A(e)}function B(e,t){var r=C.onStoppedNotification;r&&N.setTimeout((function(){return r(e,t)}))}var F={closed:!0,next:x,error:function(e){throw e},complete:x};function U(e,t,r,n,i){return new q(e,t,r,n,i)}var q=function(e){function t(t,r,n,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=r?function(e){try{r(e)}catch(n){t.error(n)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return p(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(D);function W(e,t){return u((function(r,n){var i=0;r.subscribe(U(n,(function(r){return e.call(t,r,i++)&&n.next(r)})))}))}class ClickEventPlugin{constructor(e,t){this.activity=e,this.env=t}init(){this.activity.interactions().pipe(W((e=>"click"===e.type&&!e.doNotTrack&&e.clickable))).subscribe((e=>{this.env.win.dataLayer?.push({pulse:"event",event:"click",data:{click_source:{section:e.section.name,group:e.section.group,popup_component:e.section.popupComponent,popup_component_type:e.section.popupComponentType,element:{id:e.element?.id,name:e.element?.name,node_type:e.element?.nodeName,class_list:e.element?.classList}}}})}))}}function $(e,t){return u((function(r,n){var i=0;r.subscribe(U(n,(function(r){n.next(e.call(t,r,i++))})))}))}var K=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function G(e){return c(null==e?void 0:e.then)}var J="function"==typeof Symbol&&Symbol.observable||"@@observable";function Y(e){return e}function X(e){return 0===e.length?Y:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Q=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,i=this,o=(n=e)&&n instanceof D||function(e){return e&&c(e.next)&&c(e.error)&&c(e.complete)}(n)&&P(n)?e:new V(e,t,r);return R((function(){var e=i,t=e.operator,r=e.source;o.add(t?t.call(o,r):r?i._subscribe(o):i._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Z(t))((function(t,n){var i=new V({next:function(t){try{e(t)}catch(r){n(r),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[J]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return X(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Z(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function Z(e){var t;return null!==(t=null!=e?e:C.Promise)&&void 0!==t?t:Promise}function ee(e){return c(e[J])}function te(e){return Symbol.asyncIterator&&c(null==e?void 0:e[Symbol.asyncIterator])}function re(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var ne,ie="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function oe(e){return c(null==e?void 0:e[ie])}function se(e){return g(this,arguments,(function(){var t,r,n;return d(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,m(t.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,m(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,m(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function ae(e){return c(null==e?void 0:e.getReader)}function ce(e){if(e instanceof Q)return e;if(null!=e){if(ee(e))return i=e,new Q((function(e){var t=i[J]();if(c(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(K(e))return n=e,new Q((function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()}));if(G(e))return r=e,new Q((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,A)}));if(te(e))return ue(e);if(oe(e))return t=e,new Q((function(e){var r,n;try{for(var i=f(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}e.complete()}));if(ae(e))return ue(se(e))}var t,r,n,i;throw re(e)}function ue(e){return new Q((function(t){(function(e,t){var r,n,i,o;return h(this,void 0,void 0,(function(){var s,a;return d(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=b(e),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function le(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var o=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(o),!i)return o}function pe(e,t,r){return void 0===r&&(r=1/0),c(t)?pe((function(r,n){return $((function(e,i){return t(r,e,n,i)}))(ce(e(r,n)))}),r):("number"==typeof t&&(r=t),u((function(t,n){return function(e,t,r,n,i,o,s,a){var c=[],u=0,l=0,p=!1,h=function(){!p||c.length||u||t.complete()},d=function(e){return u<n?f(e):c.push(e)},f=function(e){o&&t.next(e),u++;var a=!1;ce(r(e,l++)).subscribe(U(t,(function(e){null==i||i(e),o?d(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();s?le(t,s,(function(){return f(e)})):f(e)};c.length&&u<n;)e();h()}catch(r){t.error(r)}})))};return e.subscribe(U(t,d,(function(){p=!0,h()}))),function(){null==a||a()}}(t,n,e,r)})))}class PopupEventPlugin{constructor(e,t){this.activityTracker=e,this.env=t}init(){this.activityTracker.mutations().pipe(pe((e=>e.mutatedElements))).subscribe((e=>{e&&this.env.win.dataLayer?.push({pulse:"event",event:"popup",data:{component:e.component,component_type:e.componentType,popup_source:{section:e.section.name,group:e.section.group},action:"addedNodes"===e.mutationType?"open":"close",click_source:{url:this.activityTracker.lastClickSourceInformation?.url,section:this.activityTracker.lastClickSourceInformation?.name,group:this.activityTracker.lastClickSourceInformation?.group,popup_component:this.activityTracker.lastClickSourceInformation?.popupComponent,popup_component_type:this.activityTracker.lastClickSourceInformation?.popupComponentType,element:{id:this.activityTracker.lastClickSourceInformation?.element?.id,name:this.activityTracker.lastClickSourceInformation?.element?.name,node_type:this.activityTracker.lastClickSourceInformation?.element?.nodeName,class_list:this.activityTracker.lastClickSourceInformation?.element?.classList}}}})}))}}class RUMPlugin{constructor(e,t){this.rum=e,this.env=t}init(e){this.rum.subscribe(e.config.rumReport,e.config.rumReportOnce).subscribe((e=>{this.env.win.dataLayer?.push({pulse:"event",event:"rum",data:e})}))}}class ContextMenuPlugin{constructor(e,t){this.activity=e,this.env=t}init(){this.activity.interactions().pipe(W((e=>"contextmenu"===e.type&&"link"===e.element?.nodeType&&!e.doNotTrack&&e.clickable))).subscribe((e=>{this.env.win.dataLayer?.push({pulse:"event",event:"contextmenu",data:{click_source:{section:e.section.name,group:e.section.group,popup_component:e.section.popupComponent,popup_component_type:e.section.popupComponentType,element:{id:e.element?.id,name:e.element?.name,node_type:e.element?.nodeName,class_list:e.element?.classList}}}})}))}}!function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Verbose=4]="Verbose"}(ne||(ne={}));class LoggerService{constructor(e){this.config=e,this.logLevel=ne.Warn,this.KEY_LOG_LEVEL="log_level"}level(){return"number"!=typeof this.logLevel&&(this.logLevel=this.config.logLevel||0),this.logLevel}setLevel(e){this.logLevel=e}enabled(e){return e<=this.level()}error(e,...t){this.print(e,ne.Error,t)}warn(e,...t){this.print(e,ne.Warn,t)}info(e,...t){this.print(e,ne.Info,t)}verbose(e,...t){this.print(e,ne.Verbose,t)}print(e,t,r){if(this.enabled(t))switch(t){case ne.Error:console.log(`${e}:`),console.error(...r);break;case ne.Warn:console.warn(`${e}: `,...r);break;case ne.Info:console.info(`${e}: `,...r);break;case ne.Verbose:console.log(`${e}: `,...r)}}}var he=S((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),de=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return p(t,e),t.prototype.lift=function(e){var t=new fe(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new he},t.prototype.next=function(e){var t=this;R((function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=f(t.currentObservers),o=i.next();!o.done;o=i.next()){o.value.next(e)}}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}))},t.prototype.error=function(e){var t=this;R((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}}))},t.prototype.complete=function(){var e=this;R((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,i=r.isStopped,o=r.observers;return n||i?T:(this.currentObservers=null,o.push(e),new E((function(){t.currentObservers=null,_(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,i=t.isStopped;r?e.error(n):i&&e.complete()},t.prototype.asObservable=function(){var e=new Q;return e.source=this,e},t.create=function(e,t){return new fe(e,t)},t}(Q),fe=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return p(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:T},t}(de);class PulseStorage{constructor(e){this.options=e,this.changes=new de}change(e,t="full",r="external"){let n=this.changes.asObservable().pipe(W((e=>"all"===r||("external"===r?e.external:!e.external))));if(e)if(t&&"full"!==t){if("start"!==t)throw new Error("Invalid keyMatch value!");n=n.pipe(W((t=>t.key.startsWith(e))))}else n=n.pipe(W((t=>t.key===e)));return n}getJSON(e){const t=this.get(e);return"string"==typeof t?JSON.parse(t):null}setJSON(e,t){const r=JSON.stringify(t);this.set(e,r)}getStorageKey(e){const t=this.options.storagePrefix;return t?`${t}${e}`:e}revertStorageKey(e){const t=this.options.storagePrefix;return t?.length?e.slice(this.options.storagePrefix.length):e}isStorageKey(e){return!this.options.storagePrefix||e.startsWith(this.options.storagePrefix)}emitChange(e){this.changes.next(e)}}class TransientStorage extends PulseStorage{constructor(){super({storagePrefix:""}),this.db=new Map}get(e){return this.db.get(e)??null}set(e,t,r=!1){this.db.set(e,t),this.emitChange({key:e,value:t,external:r})}keys(){return Array.from(this.db.keys())}remove(e){this.db.delete(e),this.emitChange({key:e,value:null,external:!1})}clear(){this.db=new Map}all(){return Array.from(this.db.entries()).reduce(((e,[t,r])=>(e[t]=r,e)),{})}}class DateService{constructor(e){this.env=e;const t=this.now(),r=this.hrt(),n=e.win.performance.timeOrigin;this.hrtTimeOrigin=n??t-r}now(){return this.env.win.Date.now()}hrtTime(){return this.hrtTimeOrigin+this.env.win.performance.now()}hrt(){return this.env.win.performance.now()}timezoneOffset(){const e=new this.env.win.Date;return e.getTimezoneOffset&&e.getTimezoneOffset()}}class StateService{constructor(e,t="all"){this.storage=e,this.storageChange=t,this.KEY_STATE="state",this.registerStorageChangeListeners()}setState(e){const t=this.getState(),r={...t,...e};var n,i;(n=t)===(i=r)||"object"==typeof n&&"object"==typeof i&&Object.keys({...n,...i}).every((e=>n[e]===i[e]))||(this.state=r,this.storage.setJSON(this.KEY_STATE,r))}getState(){return this.state?this.state:this.refreshState()}refreshState(e){const t=e||this.storage.getJSON(this.KEY_STATE)||this.state||{};return this.state=t,t}registerStorageChangeListeners(){this.storage.change(this.KEY_STATE).subscribe((({value:e})=>this.refreshState(JSON.parse(e||"{}"))))}}class TransportService{constructor(e){this.env=e}send(e){e.forEach((e=>{if(this.env.win.pulse?._transport)return this.env.win.pulse?._transport({eventName:e.data.event,params:e.data.data})}))}}var ve=Array.isArray;function ye(e){return $((function(t){return function(e,t){return ve(t)?e.apply(void 0,y([],v(t))):e(t)}(e,t)}))}var me=["addListener","removeListener"],ge=["addEventListener","removeEventListener"],be=["on","off"];function Se(e,t,r,n){if(c(r)&&(n=r,r=void 0),n)return Se(e,t,r).pipe(ye(n));var i=v(function(e){return c(e.addEventListener)&&c(e.removeEventListener)}(e)?ge.map((function(n){return function(i){return e[n](t,i,r)}})):function(e){return c(e.addListener)&&c(e.removeListener)}(e)?me.map(we(e,t)):function(e){return c(e.on)&&c(e.off)}(e)?be.map(we(e,t)):[],2),o=i[0],s=i[1];if(!o&&K(e))return pe((function(e){return Se(e,t,r)}))(ce(e));if(!o)throw new TypeError("Invalid event target");return new Q((function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return o(t),function(){return s(t)}}))}function we(e,t){return function(r){return function(n){return e[r](t,n)}}}class PulseSyncStorage extends PulseStorage{constructor(e,t,r){super(r),this.storageArea=t,Se(e.win,"storage").pipe(W((e=>!!e.key&&e.storageArea===t&&this.isStorageKey(e.key))),$((e=>({key:this.revertStorageKey(e.key),value:e.newValue,external:!0})))).subscribe((e=>this.emitChange(e)))}get(e){return this.storageArea.getItem(this.getStorageKey(e))}set(e,t){try{this.storageArea.setItem(this.getStorageKey(e),t),this.emitChange({key:e,value:t,external:!1})}catch(r){console.error(r)}}keys(){return Object.keys(this.storageArea).filter((e=>this.isStorageKey(e))).map((e=>this.revertStorageKey(e)))}remove(e){this.storageArea.removeItem(this.getStorageKey(e)),this.emitChange({key:e,value:null,external:!1})}clear(){const e=this.keys();for(const t of e)this.remove(t)}all(){return Object.keys(this.storageArea).filter((e=>this.isStorageKey(e))).reduce(((e,t)=>{const r=this.revertStorageKey(t),n=this.storageArea.getItem(t);return"string"==typeof n&&(e[r]=n),e}),{})}}class PersistentStorage extends PulseSyncStorage{constructor(e,t){super(e,e.win.localStorage,t)}}class Quote{async quoteSize(){return new Promise((e=>{try{navigator.storage.estimate?navigator.storage.estimate().then((t=>{e(t.quota)})).catch((t=>{console.error(t),e(null)})):e(null)}catch(t){console.error(t),e(null)}}))}}class Step{constructor(e,t=!1){this.value=e,this.optimized=t}toString(){return this.value}}class DOMPath{xPath(e,t){if(e.nodeType===Node.DOCUMENT_NODE)return"/";const r=[];let n=e;for(;n;){const e=this.xPathValue(n,t);if(!e)break;if(r.push(e),e.optimized)break;n=n.parentNode}return r.reverse(),(r.length&&r[0]?.optimized?"":"/")+r.join("/")}xPathValue(e,t){const r=this.xPathIndex(e);let n;if(-1===r)return null;switch(e.nodeType){case Node.ELEMENT_NODE:{const r=e;if(t&&r.getAttribute("id"))return new Step('//*[@id="'+r.getAttribute("id")+'"]',!0);n=r.localName;break}case Node.ATTRIBUTE_NODE:n="@"+e.nodeName;break;case Node.TEXT_NODE:case Node.CDATA_SECTION_NODE:n="text()";break;case Node.PROCESSING_INSTRUCTION_NODE:n="processing-instruction()";break;case Node.COMMENT_NODE:n="comment()";break;case Node.DOCUMENT_NODE:default:n=""}return r>0&&(n+="["+r+"]"),new Step(n,e.nodeType===Node.DOCUMENT_NODE)}xPathIndex(e){const t=e.parentNode?e.parentNode.children:null;if(!t)return 0;let r=!1;for(const i of t)if(this.areNodesSimilar(e,i)&&i!==e){r=!0;break}if(!r)return 0;let n=1;for(const i of t)if(this.areNodesSimilar(e,i)){if(i===e)return n;++n}return-1}areNodesSimilar(e,t){if(e===t)return!0;if(e.nodeType===Node.ELEMENT_NODE&&t.nodeType===Node.ELEMENT_NODE)return e.localName===t.localName;if(e.nodeType===t.nodeType)return!0;return(e.nodeType===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:e.nodeType)===(t.nodeType===Node.CDATA_SECTION_NODE?Node.TEXT_NODE:t.nodeType)}}var _e={now:function(){return(_e.delegate||Date).now()},delegate:void 0},Ee=function(e){function t(t,r,n){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===n&&(n=_e);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return p(t,e),t.prototype.next=function(t){var r=this,n=r.isStopped,i=r._buffer,o=r._infiniteTimeWindow,s=r._timestampProvider,a=r._windowTime;n||(i.push(t),!o&&i.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,n=this._buffer.slice(),i=0;i<n.length&&!e.closed;i+=r?1:2)e.next(n[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,r=e._timestampProvider,n=e._buffer,i=e._infiniteTimeWindow,o=(i?1:2)*t;if(t<1/0&&o<n.length&&n.splice(0,n.length-o),!i){for(var s=r.now(),a=0,c=1;c<n.length&&n[c]<=s;c+=2)a=c;a&&n.splice(0,a+1)}},t}(de);function Te(e,t){return void 0===t&&(t=0),u((function(r,n){r.subscribe(U(n,(function(r){return le(n,e,(function(){return n.next(r)}),t)}),(function(){return le(n,e,(function(){return n.complete()}),t)}),(function(r){return le(n,e,(function(){return n.error(r)}),t)})))}))}function Pe(e,t){return void 0===t&&(t=0),u((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function ke(e,t){if(!e)throw new Error("Iterable cannot be null");return new Q((function(r){le(r,t,(function(){var n=e[Symbol.asyncIterator]();le(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function Ce(e,t){if(null!=e){if(ee(e))return function(e,t){return ce(e).pipe(Pe(t),Te(t))}(e,t);if(K(e))return function(e,t){return new Q((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}(e,t);if(G(e))return function(e,t){return ce(e).pipe(Pe(t),Te(t))}(e,t);if(te(e))return ke(e,t);if(oe(e))return function(e,t){return new Q((function(r){var n;return le(r,t,(function(){n=e[ie](),le(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(o){return void r.error(o)}i?r.complete():r.next(t)}),0,!0)})),function(){return c(null==n?void 0:n.return)&&n.return()}}))}(e,t);if(ae(e))return function(e,t){return ke(se(e),t)}(e,t)}throw re(e)}function Ne(e,t){return t?Ce(e,t):ce(e)}function Ae(e){return void 0===e&&(e=1/0),pe(Y,e)}function xe(e,t,r){var n=c(e)||t||r?{next:e,error:t,complete:r}:e;return n?u((function(e,t){var r;null===(r=n.subscribe)||void 0===r||r.call(n);var i=!0;e.subscribe(U(t,(function(e){var r;null===(r=n.next)||void 0===r||r.call(n,e),t.next(e)}),(function(){var e;i=!1,null===(e=n.complete)||void 0===e||e.call(n),t.complete()}),(function(e){var r;i=!1,null===(r=n.error)||void 0===r||r.call(n,e),t.error(e)}),(function(){var e,t;i&&(null===(e=n.unsubscribe)||void 0===e||e.call(n)),null===(t=n.finalize)||void 0===t||t.call(n)})))})):Y}const Le=e=>{let t="other";return"A"===e.nodeName?t="link":"BUTTON"===e.nodeName||e instanceof HTMLInputElement&&"button"===e.type?t="button":e instanceof HTMLInputElement&&("submit"===e.type?t="submit":"reset"===e.type?t="reset":"file"===e.type?t="file":"submit"!==e.type&&"reset"!==e.type&&"file"!==e.type&&(t="input")),t},Ie=(e,t)=>t?.hasAttribute(e)||t?.hasAttribute(`data-${e}`),Oe=e=>e instanceof HTMLAnchorElement||e instanceof HTMLButtonElement?e.innerText:e instanceof HTMLInputElement&&("button"===e.type||"submit"===e.type||"reset"===e.type)?e.value:e===document.body?"<body>":e===document.documentElement?"<document>":e===document.head?"<head>":e.labels?.length?Array.from(e.labels||[]).map((e=>e.innerText)).join(" "):null,Re=e=>{const t=Le(e),r=Array.from(e.classList),n=(e=>{const t=["class","value","id","name"];return Array.from(e.attributes).map((e=>({name:e.name,value:e.value}))).filter((e=>-1===t.indexOf(e.name)))})(e),i=e.getAttribute("pulse-name")||e.getAttribute("data-pulse-name")||e.getAttribute("pulse-clickable")||e.getAttribute("data-pulse-clickable")||e.name||e.getAttribute("name")||void 0;return{attributes:n,attributeValueByName:n.reduce(((e,t)=>({...e,[t.name]:t.value})),{}),classList:r,nodeType:t,id:e.id,name:i,nodeName:e.nodeName,text:Oe(e)||void 0}},De=(e,t,r=void 0)=>{const n=e?e.getAttribute("pulse-section")||e.getAttribute("data-pulse-section"):null,i=t?t.getAttribute("pulse-section-group")||t.getAttribute("data-pulse-section-group"):null,o=r?r.getAttribute("pulse-component")||r.getAttribute("data-pulse-component"):null,s=r?r.getAttribute("pulse-componen-type")||r.getAttribute("data-pulse-component-type"):null;return{name:n||i||void 0,group:i||n||void 0,sectionElement:e&&Re(e),sectionGroupElement:t&&Re(t),popupComponent:o||void 0,popupComponentType:s||void 0}},je=["click","contextmenu"],Me=[...je];class ActivityTracker{constructor(e,t){this.visibilityTracker=e,this.win=t,this.registerListeners()}interactions(){return this.interactionEventsSubject}mutations(){return this.mutationEventsSubject}registerListeners(){if(!this.interactionEventsSubject){const e=this.interactionEvents(),t=this.mutationEvents(),r=new Ee,n=new Ee;e.subscribe(r),t.subscribe(n),this.interactionEventsSubject=r,this.mutationEventsSubject=n}}mutationEvents(){const e=new Ee;return new MutationObserver((t=>{const r=this.getMutatedElements(t,"addedNodes"),n=this.getMutatedElements(t,"removedNodes");(r.length||n.length)&&e.next({mutatedElements:[...r,...n]})})).observe(document,{childList:!0,subtree:!0}),e}isHidden(e){const t=this.win.win.getComputedStyle(e);return"none"===t.display||"hidden"===t.visibility||void 0===t.display}interactionEvents(){const e=this.win.doc.body,t={capture:!0,passive:!0};return Ne(Me).pipe($((r=>Se(e,r,t))),Ae(),$((e=>this.processWindowEvent(e))),W(Boolean),xe((e=>{"click"!==e.type&&"contextmenu"!==e.type||e.doNotTrack||!e.clickable||(this.lastClickSourceInformation={name:e.section.name,group:e.section.group,popupComponent:e.section.popupComponent,popupComponentType:e.section.popupComponentType,element:e.element,url:e.docURL})})))}getMutatedElements(e,t){return e.flatMap((e=>{const r=e.target;return Array.from(e[t]).map((e=>({node:e,target:r})))})).filter((({node:e})=>e instanceof HTMLElement)).flatMap((e=>{const r=this.getInteractionInfoFor(e.node,e.target);let n;if(!r)return[];if(r&&Ie("pulse-component",r.element))n=Re(r.element);else{const e=r.element.querySelectorAll("[pulse-component], [data-pulse-component]");if(!e||!e[0])return[];n=Re(e[0])}const i=n.attributeValueByName["pulse-component"]||n.attributeValueByName["data-pulse-component"],o=n.attributeValueByName["pulse-component-type"]||n.attributeValueByName["data-pulse-component-type"];return"addedNodes"===t&&this.isHidden(r.element)?[]:{element:n,component:i,componentType:o||i,mutationType:t,section:De(r.section,r.sectionGroup)}}))}processWindowEvent(e){if(!e.target)return null;const t=this.getInteractionInfoFor(e.target);if(!t)return null;const r=window.document;return{type:e.type,trusted:e.isTrusted??!0,eventPhase:e.eventPhase,bubbles:e.bubbles,section:De(t.section,t.sectionGroup,t.popupComponent),element:Re(t.element),docFocused:r.hasFocus(),docVisible:this.visibilityTracker.visible,docURL:r.location.href,doNotTrack:t.doNotTrack,clickable:t.clickable,ts:Date.now()}}getInteractionInfoFor(e,t){const r=this.win.doc,n=e instanceof Node&&e!==r&&e!==r.head?e:r.documentElement;let i=(e=>{let t=e;for(;t;){if(t instanceof HTMLElement)return t;t=t.parentElement}return null})(n);if(!i)return;const o=Le(n),s=t instanceof Element?t.closest("[pulse-section]")||t.closest("[data-pulse-section]"):void 0,a=t instanceof Element?t.closest("[pulse-section-group]")||t.closest("[data-pulse-section-groups]"):void 0,c=s||i.closest("[pulse-section]")||i.closest("[data-pulse-section]")||void 0,u=a||i.closest("[pulse-section-group]")||i.closest("[data-pulse-section-group]")||void 0,l=i.closest("[pulse-component]")||i.closest("[data-pulse-component]")||void 0,p=(e=>{let t=e,r=!1;for(;t&&!r;){const e=Le(t);r=Boolean("submit"===e||"button"===e||"link"===e||Ie("pulse-clickable",t)),r||(t=t.parentElement)}return t})(i);i=p||i;const h=Boolean(i.closest("[pulse-dnt]"));return{clickable:Boolean(p),doNotTrack:Boolean(h),type:o,element:i,section:c,sectionGroup:u,popupComponent:l}}}var ze=new Q((function(e){return e.complete()}));function Ve(e){return e[e.length-1]}function He(e){return(t=Ve(e))&&c(t.schedule)?e.pop():void 0;var t}function Be(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=He(e),n=function(e,t){return"number"==typeof Ve(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?ce(i[0]):Ae(n)(Ne(i,r)):ze}function Fe(e,t){return void 0===t&&(t=Y),e=null!=e?e:Ue,u((function(r,n){var i,o=!0;r.subscribe(U(n,(function(r){var s=t(r);!o&&e(i,s)||(o=!1,i=s,n.next(r))})))}))}function Ue(e,t){return e===t}const qe={capture:!0,passive:!0};class DocumentVisibilityTracker{constructor(e){this.env=e,this.hiddenPropName="hidden",this.visibilityStatePropName="visibilityState",this.visibilityEventName="visibilitychange",this.configureVisibilityListener()}get visible(){return this.isPageVisible()}onVisibilityChange(){const e=this.env.win.document;let t=new de;return this.configureVisibilityListener()&&(t=Se(e,this.visibilityEventName).pipe($((()=>this.isPageVisible())))),this.fullVisibilityAPISupport()||(t=Be(t,this.legacyVisibilityEvents())),t.pipe(Fe())}legacyOnUnload(){const e=this.env.win;return Be(this.legacyPageHide(),Se(e,"beforeunload",qe),Se(e,"unload",qe))}legacyPageHide(){return Se(this.env.win,"pagehide",qe)}legacyVisibilityEvents(){return Be(this.legacyOnUnload().pipe($((()=>!1))),Se(this.env.win,"pageshow",qe).pipe($((()=>!0))),Se(this.env.win,"focus",qe).pipe($((()=>!0)))).pipe(Fe())}isPageVisible(){const e=this.env.doc;return"string"==typeof e[this.visibilityStatePropName]&&e[this.visibilityStatePropName]?"visible"===e[this.visibilityStatePropName]:"boolean"==typeof e[this.hiddenPropName]?!e[this.hiddenPropName]:!this.env.win.document.hasFocus||this.env.win.document.hasFocus()}configureVisibilityListener(){const e=["","ms","webkit","moz","o"],t=this.env.doc;for(const r of e){const e=r?`${r}Hidden`:"hidden",n=r?`${r}VisibilityState`:"visibilityState",i=(r||"")+"visibilitychange";if(e in t||n in t)return this.hiddenPropName=e,this.visibilityEventName=i,this.visibilityStatePropName=n,!0}return!1}fullVisibilityAPISupport(){const e=this.env.doc,t=this.env.win.navigator.userAgent;return"string"==typeof e.visibilityState&&"boolean"==typeof e.hidden&&void 0!==e.onvisibilitychange&&!/Safari/i.test(t)}}class DataLayerService{constructor(e){this.env=e}pushData(e){this.env.win.dataLayer||(this.env.win.dataLayer=[]),this.env.win.dataLayer.push(e)}}class LocationHistoryTracker{constructor(e){this.env=e,this.navigation=new de,this.init()}init(){this.env.win.pulse?._route?.subscribe((e=>{this.navigation.next(e.route)}))}}function We(e,t){return u((function(r,n){var i=null,o=0,s=!1,a=function(){return s&&!i&&n.complete()};r.subscribe(U(n,(function(r){null==i||i.unsubscribe();var s=0,c=o++;ce(e(r,c)).subscribe(i=U(n,(function(e){return n.next(t?t(r,e,c,s++):e)}),(function(){i=null,a()})))}),(function(){s=!0,a()})))}))}var $e=S((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Ke(){return new $e}function Ge(e,t){var r=arguments.length>=2;return function(n){return n.pipe(e?W((function(t,r){return e(t,r,n)})):Y,(o=1)<=0?function(){return ze}:u((function(e,t){var r=0;e.subscribe(U(t,(function(e){++r<=o&&(t.next(e),o<=r&&t.complete())})))})),r?function(e){return u((function(t,r){var n=!1;t.subscribe(U(r,(function(e){n=!0,r.next(e)}),(function(){n||r.next(e),r.complete()})))}))}(t):(void 0===(i=function(){return new $e})&&(i=Ke),u((function(e,t){var r=!1;e.subscribe(U(t,(function(e){r=!0,t.next(e)}),(function(){return r?t.complete():t.error(i())})))}))));var i,o}}function Je(e,t){const r="string"==typeof t?t:t?.entryType,n=e.entry_type===r,i=function(e,t){if("string"==typeof t)return!0;if(void 0===t.name)return!0;if(Array.isArray(t.name))return t.name.some((t=>t instanceof RegExp?t.test(e):t===e));return!1}(e.name,t),o="object"!=typeof t||"function"!=typeof t.filter||t.filter(e);return n&&i&&o}class RUMService{constructor(e,t){this.timeline=e,this.resource=t}subscribe(e,t){const r=[...e,...t||[]],n=r.some((e=>"resource"===e||"object"==typeof e&&"resource"===e.entryType)),i=Be(n?this.resource.subscribe(r):Ne([]),this.timeline.subscribe(r).pipe(W((e=>"resource"!==e.entry_type)))),o=i.pipe(W((e=>!t||t.every((t=>!Je(e,t))))));return Be(Ne(t||[]).pipe(We((e=>i.pipe(W((t=>Je(t,e))),Ge())))),o).pipe($((e=>this.enrichWithServerAttributes(e))))}enrichWithServerAttributes(e){if(Array.isArray(e.server_timing)){const t=[...e.server_timing],r={};for(const n of e.server_timing){const e=/^pulse\$([^$]+)\$([^$]+)$/.exec(n.name);if(!e?.length)continue;const i=(e[1]||"").toLowerCase(),o=(e[2]||"").toLowerCase();r[i]=o,t.splice(t.indexOf(n),1)}e.server_timing=t,e.server_attributes=r}return e}}class PerformanceTimelineService{constructor(e,t,r,n){this.env=e,this.cssPathService=t,this.date=r,n.visible||(this.firstPageHide=r.hrtTimeOrigin),n.onVisibilityChange().pipe(W((e=>!e)),Ge()).subscribe((()=>{this.firstPageHide=r.hrt()}))}subscribe(e,t=!0){return Be(...e.filter((e=>this.entrySupported(e))).map((e=>this.getFilterStream(e,t))))}getEntries(e){return Be(...e.filter((e=>this.entrySupported(e))).map((e=>this.getFilterStream(e,!1,!0))))}getFilterStream(e,t,r){const n=this.env.win;return n.performance.getEntries&&n.performance.getEntriesByType&&n.performance.timeOrigin?r?this.readEntries(e):"function"==typeof n.PerformanceObserver&&n.WeakSet?this.getFilterStreamNative(e,t):this.getFilterStreamLegacy(e,t):Ne([])}readEntries(e){const t="string"==typeof e?e:e.entryType,r=new WeakSet;return Ne(this.env.win.performance.getEntriesByType(t)).pipe(W((e=>!r.has(e))),xe((e=>r.add(e))),$((e=>this.mapEntry(e))),W((t=>Je(t,e))))}getFilterStreamNative(e,t){return new Q((r=>{const n=new WeakSet,i=new this.env.win.PerformanceObserver((t=>{const i=t.getEntries();for(const o of i){if(n.has(o))continue;n.add(o);const t=this.mapEntry(o);Je(t,e)&&r.next(t)}})),o="string"==typeof e?e:e?.entryType;return i.observe({type:o,buffered:t}),()=>i.disconnect()}))}getFilterStreamLegacy(e,t){return new Q((r=>{const n=this.env.win.performance,i="string"==typeof e?e:e?.entryType;let o=t?0:n.now();const s=setInterval((()=>{const t=this.env.win.performance.getEntriesByType(i);let n=o;for(const i of t){const t=this.mapEntry(i);n<i.startTime&&(n=i.startTime),i.startTime<o||Je(t,e)&&r.next(t)}o=n}),1e3);return()=>clearInterval(s)}))}mapEntry(e){const t=this.env.win.navigator.connection,r="xmlhttprequest"===(e.initiatorType+"").toLowerCase()?"xhr":e.initiatorType;let n={time_origin:this.date.hrtTimeOrigin,details:e.detail,name:e.name,entry_type:e.entryType,type:e.type,protocol:e.nextHopProtocol||void 0,task_duration:e.duration,start_time:e.startTime,end_time:e.responseEnd??(e.duration?e.startTime+e.duration:void 0),initiator_type:r,worker_start:e.workerStart,redirect_start:e.redirectStart,redirect_end:e.redirectEnd,fetch_start:e.fetchStart,domain_lookup_start:e.domainLookupStart,domain_lookup_end:e.domainLookupEnd,connect_start:e.connectStart,connect_end:e.connectEnd,secure_connection_start:e.secureConnectionStart,request_start:e.requestStart,response_start:e.responseStart,response_end:e.responseEnd,transfer_size:e.transferSize,encoded_body_size:e.encodedBodySize,decoded_body_size:e.decodedBodySize,unload_event_start:e.unloadEventStart,unload_event_end:e.unloadEventEnd,dom_interactive:e.domInteractive,dom_content_loaded_event_start:e.domContentLoadedEventStart,dom_content_loaded_event_end:e.domContentLoadedEventEnd,dom_complete:e.domComplete,load_event_start:e.loadEventStart,load_event_end:e.loadEventEnd,redirect_count:e.redirectCount,processing_start:e.processingStart,processing_end:e.processingEnd,cancelable:e.cancelable,render_blocking:e.renderBlockingStatus?"blocking"===e.renderBlockingStatus:void 0,had_recent_input:e.hadRecentInput,last_input_time:e.lastInputTime,cls_value:e.value,before_page_hide:this.beforePageHide(e.startTime)};return Array.isArray(e.serverTiming)&&e.serverTiming.length&&(n.server_timing=e.serverTiming),Array.isArray(e.workerTiming)&&e.workerTiming.length&&(n.worker_timing=e.workerTiming),!t||"resource"!==n.entry_type&&"navigation"!==n.entry_type||(n={...n,connection_downlink:t.downlink,connection_rtt:t.rtt,connection_type:t.effectiveType,data_saving_mode:t.saveData}),Array.isArray(e.attribution)&&(n.attribution=e.attribution.map((e=>({name:e?.name,entry_type:e?.entryType,start_time:e?.startTime,duration:e?.duration,container_type:e?.containerType,container_src:e?.containerSrc,container_id:e?.containerId,container_name:e?.containerName})))),"layout-shift"===n.entry_type&&Array.isArray(e.sources)&&(n.cls_sources=e.sources.map((e=>this.createCLSAttribution(e))).filter(Boolean)),n}beforePageHide(e){return!this.firstPageHide||(e?e<this.firstPageHide:void 0)}entrySupported(e){const t=this.env.win.PerformanceObserver?.supportedEntryTypes||[],r="string"==typeof e?e:e.entryType;return t.indexOf(r)>-1}createCLSAttribution(e){if("object"!=typeof e||"object"!=typeof e.node)return null;const t=e.node,r={current_rect:e.currentRect,previous_rect:e.previousRect};if(t){const e=this.cssPathService.cssPath(t);r.node={path:e}}return r}}class RequestMonitorService{constructor(e,t,r,n,i){this.fetchCollector=e,this.xhrCollector=t,this.timeline=r,this.date=n,this.env=i;const o=new Ee(1e3);this.performanceTimeline=o,this.timeline.subscribe(["resource"]).subscribe(o)}subscribe(e){const t=this.date.hrt(),r=Be(this.fetchCollector.requests(),this.xhrCollector.requests()).pipe(We((e=>this.findEntry(e))));return Be(this.performanceTimeline.pipe(W((e=>"fetch"!==e.initiator_type&&"xhr"!==e.initiator_type||e.start_time<=t)),$((e=>({entry:e})))),r).pipe($((e=>this.mergeRequestEntry(e))),W(Boolean),W((t=>!e||e.some((e=>Je(t,e))))))}mergeRequestEntry(e){const t=e.request,r=!!t&&("basic"===t.responseMode||"cors"===t.responseMode||"default"===t.responseMode);let n=e.entry;if(n)n.response_entry_matched=!!t;else{if(!t)return null;const e=this.env.win.navigator.connection;n={name:t.url,entry_type:"resource",initiator_type:t.initiator,start_time:t.start,end_time:t.end,task_duration:(t.fetchEnd||t.end)-t.start,time_origin:this.date.hrtTimeOrigin,response_entry_matched:!1},r&&(n.decoded_body_size=t.responseBodySize,n.transfer_size=t.responseBodySize),e&&(n={...n,connection_downlink:e.downlink,connection_rtt:e.rtt,connection_type:e.effectiveType,data_saving_mode:e.saveData})}return t&&this.enrichWithRequest(n,t,r),n}enrichWithRequest(e,t,r){e.request_method=t.method,e.response_status=t.responseStatus,e.response_mode=t.responseMode,e.request_body_size=t.requestBodySize,e.response_end=e.response_end||t.fetchEnd||t.end,e.end_time=t.end,e.user_duration=t.end-t.start,e.response_content_type=t.responseContentType,e.request_content_type=t.requestContentType,e.redirected=t.redirected,e.aborted=t.aborted,r&&(e.transfer_size=e.transfer_size||t.responseBodySize,e.response_body_size=t.responseBodySize,e.decoded_body_size=t.responseBodySize,e.transfer_size=t.responseBodySize)}findEntry(e){return this.performanceTimeline.pipe(W((e=>"fetch"===e.initiator_type||"xhr"===e.initiator_type)),W((t=>this.matchLax(e,t))),Ge(),$((t=>({entry:t,request:e}))))}matchLax(e,t){const r=t.start_time,n=t.task_duration?t.start_time+t.task_duration:t.response_end||0;return r>=e.start-1&&n<=e.end+1&&e.url===t.name}}function Ye(e){return new Promise((t=>{setTimeout(t,e)}))}const Xe=new Set(["plain/text","text/html","text/css","text/xml","text/csv","text/javascript","application/json","application/ld+json","application/xml","application/xhtml+xml","application/atom+xml","application/javascript","application/x-javascript","image/svg+xml"]),Qe=new Set(["font/woff2","font/ttf","image/gif","image/png","image/jpg","image/jpeg","image/webp","image/bmp"]),Ze=new Set([...Xe.values(),...Qe.values()]);function et(e,t){try{return new URL("string"==typeof e?e:e.href,t.win.location.href).href}catch(r){return"string"==typeof e?e:"object"==typeof e&&e.href?e.href:void 0}}function tt(e){if(e)return e.toLowerCase().split(";").map((e=>e.trim()))[0]}class task_AsyncTask{constructor(){this.completed=!1,this.task=new Promise(((e,t)=>{this.resolveTask=e,this.rejectTask=t}))}resolve(e){this.completed||(this.completed=!0,this.resolveTask(e))}reject(e){this.completed||(this.completed=!0,this.rejectTask(e))}waitUntilResolved(){return this.task}}function rt(e,t){try{if(null==e||""===e)return 0;if("string"==typeof e)return new t.Blob([e]).size;if(e instanceof t.Blob)return e.size;if((e instanceof t.ArrayBuffer||t.ArrayBuffer.isView(e))&&"number"==typeof e.byteLength)return e.byteLength;if(e instanceof t.URLSearchParams)return rt(e.toString(),t);if("object"==typeof e)return rt(JSON.stringify(e),t)}catch{}}function nt(e,t,r,n){if(t?.body&&!function(e,t){return"ReadableStream"in t&&e instanceof t.ReadableStream}(t.body,n.win)){const r=new AsyncTask;try{const e=rt(t.body,n.win);r.resolve({size:e,start:-1,end:-1,cancelled:!1})}catch(i){r.reject(i)}return{wrappedRequest:new Request(e,t),bodyStats:r.waitUntilResolved()}}if("object"==typeof e&&e.body instanceof ReadableStream){const{wrappedStream:o,complete:s}=function(e,t,r){const n=new task_AsyncTask,o=new task_AsyncTask;let s=-1;const a=new r.ReadableStream({start(n){s=t.hrt();const a=e.getReader();let c=0;a.read().then((({done:e,value:a})=>{if(e){const e=t.hrt();return o.resolve({start:s,end:e,size:c,cancelled:!1}),void n.close()}try{c+=rt(a,r)??0}catch(i){console.error(i)}n.enqueue(a)})).catch((e=>{o.reject(e),n.error(e)}))},cancel(r){e.cancel(r);const n=t.hrt();o.resolve({start:s,end:n,cancelled:!0})}});return{started:n.waitUntilResolved(),complete:o.waitUntilResolved(),wrappedStream:a}}(e.body,r,n.win),a={cache:e?.cache,credentials:e?.credentials,headers:e?.headers,integrity:e?.integrity,keepalive:e?.keepalive,method:e?.method,mode:e?.mode,redirect:e?.redirect,referrer:e?.referrer,referrerPolicy:e?.referrerPolicy,signal:e?.signal,...t||{},body:o};return{wrappedRequest:new Request(e,a),bodyStats:s}}return{wrappedRequest:new Request(e,t),bodyStats:Promise.resolve(void 0)}}class FetchCollectorService{constructor(e,t){this.date=e,this.env=t,this.reportStream=new de,this.patched=!1}requests(){return this.patchFetch(),this.reportStream.asObservable()}supported(){return"ReadableStream"in this.env.win&&"ArrayBuffer"in this.env.win&&"Request"in this.env.win&&"Response"in this.env.win&&"function"==typeof this.env.win.fetch}patchFetch(){if(this.patched||!this.supported())return;const e=this.env.win,t=e.fetch.bind(e);this.env.win.fetch=async(e,r)=>this.monitoredFetch(e,r,t),this.patched=!0}async monitoredFetch(e,t,r){const n={url:"",method:"",start:0,fetchEnd:0,end:0,responseStatus:0,initiator:"fetch"};let i,o,s;try{i=nt(e,t,this.date,this.env),n.url=et(i.wrappedRequest.url,this.env)||"",n.method=i.wrappedRequest.method.toUpperCase(),i.bodyStats.then((e=>{n.requestBodySize=e?.size})).catch((e=>{console.error(e)})),i.wrappedRequest.signal?.addEventListener("abort",(()=>{n.aborted=!0})),n.start=this.date.hrt(),o=await r(i.wrappedRequest),n.fetchEnd=this.date.hrt();try{n.responseBodySize=o.headers.has("content-length")?+o.headers.get("content-length"):void 0;("basic"===o.type||"cors"===o.type||"default"===o.type)&&n.responseContentType&&!Number.isSafeInteger(n.responseBodySize)&&Ze.has(n.responseContentType)&&(s=o.clone())}catch{}return o}finally{n.fetchEnd=o?n.fetchEnd:this.date.hrt(),Ye(0).then((()=>this.reportResponse(o,s,n))).catch((e=>console.error(e)))}}async reportResponse(e,t,r){if(r){if(e)try{const n=e.headers?.get("content-type");if(r.responseContentType=tt(n),r.redirected=e.redirected,r.responseMode=e.type,r.responseStatus=e.status,!Number.isSafeInteger(r.responseBodySize)&&t)try{const e=await t.blob();r.responseBodySize=e.size}catch{}}catch{}r.end=this.date.hrt(),this.reportStream.next(r)}}}function it(e,t){if(!t||!e)return!1;if(Xe.has(t))return!0;if(Qe.has(t))try{return e instanceof Blob||e instanceof ArrayBuffer}catch(r){console.error(r)}return!1}function ot(e,t){const r=new de;function n(n){if(n.___pulse)return n.___pulse;const i={requestHeaders:new Headers,hasError:!1};return n.___pulse=i,n.addEventListener("error",(()=>{i.hasError=!0})),n.addEventListener("timeout",(()=>{i.hasError=!0,i.aborted=!0})),n.addEventListener("loadend",(o=>{i.end=e.hrt(),Ye(0).then((()=>function(n,i,o){const s=tt(i.requestHeaders.get("content-type"));let a,c,u;it(i.requestBody,s)&&(a=rt(i.requestBody,t.win));let l={url:i.url,method:i.method,start:i.start,fetchEnd:i.end,end:i.end,aborted:!!i.aborted,requestBodySize:a,requestContentType:s,responseStatus:n.status,initiator:"xhr"};if(i.hasError)r.next(l);else{try{u=tt(n.getResponseHeader("content-type"))}catch(p){console.error(p)}if(o.lengthComputable&&"number"==typeof o.total)c=o.total;else try{const e=+n.getResponseHeader("content-length");Number.isSafeInteger(e)&&(l.responseBodySize=e)}catch(p){console.error(p)}"number"!=typeof l.responseBodySize&&it(n.response,u)&&(c=rt(n.response,t.win)),l={...l,responseBodySize:c,responseContentType:u,end:e.hrt()},r.next(l)}}(n,i,o))).catch((e=>console.error(e)))})),i}function i(e,t){const r=XMLHttpRequest.prototype[e];"function"==typeof r&&(XMLHttpRequest.prototype[e]=function(...e){const i=this,o=n(i);return t(i,o,r.bind(i),...e)})}return i("setRequestHeader",((e,t,r,...n)=>{const[i,o]=n;try{t.requestHeaders.set(i,o)}catch(s){console.error(s)}r.apply(e,n)})),i("open",((e,r,n,...i)=>{const[o,s]=i;n.apply(e,i),r.method=o,r.url=et(s,t)||""})),i("send",((t,r,n,...i)=>{r.requestBody,r.start=e.hrt(),n.apply(t,i)})),i("abort",((e,t,r)=>{t.aborted=!0,r.apply(e)})),r.asObservable()}class XHRCollectorService{constructor(e,t){this.date=e,this.env=t}requests(){return this.stream||(this.stream=ot(this.date,this.env)),this.stream}}class CSSPathStep{constructor(e,t){this.value=e,this.optimized=t}toString(){return this.value}}class CSSPathService{cssPath(e,t=!1){try{if(e.nodeType!==Node.ELEMENT_NODE)return"";const r=[];let n=e;for(;n;){const i=this.createStep(n,!!t,n===e);if(!i)break;if(r.push(i),i?.optimized)break;n=n.parentNode}return r.reverse(),r.join(" > ")}catch(r){return console.error(r),""}}createStep(e,t,r){if(e.nodeType!==Node.ELEMENT_NODE)return null;const n=e.getAttribute("id");if(t){if(n)return new CSSPathStep(this.idSelector(n),!0);const t=e.nodeName.toLowerCase();if("body"===t||"head"===t||"html"===t)return new CSSPathStep(e.nodeName.toLowerCase(),!0)}const i=e.nodeName.toLowerCase();if(n)return new CSSPathStep(i.toLowerCase()+this.idSelector(n),!0);const o=e.parentNode;if(!o||o.nodeType===Node.DOCUMENT_NODE)return new CSSPathStep(i.toLowerCase(),!0);const s=this.prefixedElementClassNames(e),a=o.children;let c=!1,u=!1,l=-1;for(let h=0;(-1===l||!u)&&h<a.length;++h){const t=a[h];if(t===e){l=h;continue}if(u)continue;if(t?.nodeName.toLowerCase()!==i.toLowerCase())continue;c=!0;const r=s;let n=0;for(const e in r)++n;if(0===n){u=!0;continue}const o=this.prefixedElementClassNames(t);for(const e of o)if(!r.indexOf(e)&&(delete r[e],!--n)){u=!0;break}}let p=i.toLowerCase();if(r&&"input"===i.toLowerCase()&&e.getAttribute("type")&&!e.getAttribute("id")&&!e.getAttribute("class")&&(p+='[type="'+e.getAttribute("type")+'"]'),u)p+=":nth-child("+(l+1)+")";else if(c)for(const h in s)p+="."+this.escapeIdentifierIfNeeded(s[h]?.substr(1)||"");return new CSSPathStep(p,!1)}prefixedElementClassNames(e){const t=e.getAttribute("class");return t?t.split(/\s+/g).filter(Boolean).map((e=>"$"+e)):[]}idSelector(e){return"#"+this.escapeIdentifierIfNeeded(e)}escapeIdentifierIfNeeded(e){if(this.isCSSIdentifier(e))return e;const t=/^(?:[0-9]|-[0-9-]?)/.test(e),r=e.length-1;return e.replace(/./g,((e,n)=>t&&0===n||!this.isCSSIdentChar(e)?this.escapeAsciiChar(e,n===r):e))}escapeAsciiChar(e,t){return"\\"+this.toHexByte(e)+(t?"":" ")}toHexByte(e){let t=e.charCodeAt(0).toString(16);return 1===t.length&&(t="0"+t),t}isCSSIdentChar(e){return!!/[a-zA-Z0-9_-]/.test(e)||e.charCodeAt(0)>=160}isCSSIdentifier(e){return/^-?[a-zA-Z_][a-zA-Z0-9_-]*$/.test(e)}}class ActivitySynchronizer{constructor(e,t,r,n){this.persistentStorage=e,this.activityTracker=t,this.date=r,this.config=n,this.pageEvents=[]}startService(){this.activityTracker.interactions().pipe(W((e=>"click"===e.type&&!e.doNotTrack&&e.clickable))).subscribe((e=>{const t=this.date.now();this.pageEvents.push(e),this.pageEvents=this.pageEvents.slice(this.pageEvents.length-100).filter((e=>t-e.ts<=this.config.detectionTimeWindow)),this.pageEvents.length?this.persistentStorage.setJSON("activity",this.pageEvents):this.remove()}))}getEvents(){return this.persistentStorage.getJSON("activity")}remove(){this.persistentStorage.remove("activity")}}class NavigationEventService{constructor(e,t){this.env=e,this.inititatorDetector=t}send(e,t){const r={event:"navigation",pulse:"event",data:{initial:e,url:t,click_source:{}}},n=this.inititatorDetector.getTriggerEvent(e);!this.inititatorDetector.isFirstNavigation()&&n?.element&&(r.data.click_source={section:n?.name,group:n?.group,url:n?.url,element:{id:n?.element?.id,name:n?.element?.name,node_type:n?.element?.nodeName,class_list:n?.element?.classList}}),this.env.win.dataLayer?.push(r)}}var st;!function(e){e[e.LinkInteraction=1]="LinkInteraction",e[e.Link=2]="Link",e[e.Interaction=3]="Interaction",e[e.Focus=4]="Focus",e[e.Visibility=5]="Visibility",e[e.NoVisibility=6]="NoVisibility"}(st||(st={}));class InitiatorDetector{constructor(e,t,r,n,i){this.storage=e,this.activitySyncService=t,this.date=r,this.env=n,this.config=i,this.firstNavigationKey="first_navigation",this.firstNavigation=!0}isFirstNavigation(){return this.firstNavigation}getTriggerEvent(e=!1){const t=this.storage.getJSON(this.firstNavigationKey),r=void 0===t?.firstNavigation,n=t?.lastNavigationCount||0;this.storage.setJSON(this.firstNavigationKey,{firstNavigation:!1,lastNavigationCount:this.env.win.history.length,lastNavigationUrl:this.env.win.location.href}),this.firstNavigation=r;const i=this.env.win.history.length-n>1&&!r,o=i?5e3:e?3500:500,s=st.NoVisibility,a=t?.lastNavigationUrl||this.env.win.document.referrer,c=this.activitySyncService.getEvents()||[],u=this.detectTriggerEvent(a,c,o,s,i);return u?{type:u?.type,url:u?.eventUrl,name:u?.section.name,group:u?.section.group,element:u?.element}:null}detectTriggerEvent(e,t,r,n,i){const o=this.ctreateTriggerEvents(e,t).filter((e=>e.timeDiff<=r));if(!o.length)return null;for(let s=1;s<=n;s++){const t=this.filterAccuracyMatches(o,e,s,i);if(t.length&&s<st.NoVisibility)return t[0]||null}return null}filterAccuracyMatches(e,t,r,n){switch(r){case st.LinkInteraction:return this.filterLinkInteractionEvents(e,t);case st.Link:return this.filterLinkEvents(e,t);case st.Interaction:return this.filterInteractionEvents(e,t);case st.Focus:return this.filterFocusedEvents(e,t,n);case st.Visibility:return this.filterVisibleEvents(e,t);case st.NoVisibility:default:return this.filterNoVisibility(e,t)}}filterLinkInteractionEvents(e,t){return e.filter((e=>(!t||e.docURL.startsWith(t))&&this.isLinkMatch(e)&&this.isInteractionEvent(e)&&e.docFocused&&e.docVisible))}filterLinkEvents(e,t){return e.filter((e=>(!t||e.docURL.startsWith(t))&&this.isLinkMatch(e)&&e.docFocused&&e.docVisible))}filterInteractionEvents(e,t){return e.filter((e=>(!t||e.docURL.startsWith(t))&&this.isInteractionEvent(e)&&e.docFocused&&e.docVisible))}filterFocusedEvents(e,t,r){return e.filter((e=>r?e.docFocused&&e.docVisible:(!t||e.docURL.startsWith(t))&&e.docFocused&&e.docVisible))}filterVisibleEvents(e,t){return e.filter((e=>(!t||e.docURL.startsWith(t))&&e.docVisible))}filterNoVisibility(e,t){return e.filter((e=>!t||e.docURL.startsWith(t)))}isLinkMatch(e){if(e.element&&"A"===e.element.nodeName){const t=e.element.attributes.find((e=>"href"===e.name))?.value;return t===this.config.initialDocURL}return!1}isInteractionEvent(e){return-1!==je.indexOf(e.type)}ctreateTriggerEvents(e,t){const r=this.date.now()-2;let n=[];return n=t.map((t=>({...t,timeDiff:Math.abs(r-t.ts),referrerMatch:!e||t.docURL.startsWith(e),eventUrl:t.docURL}))),n.sort(((e,t)=>e.timeDiff>t.timeDiff?1:e.timeDiff<t.timeDiff?-1:0))}}class TrackerConfigurations{}const at={app:"",app_id:"",debug:[],locksMaxAge:864e5,dataLayerKey:"dataLayer",pulseClientType:"browser",rumUnsafeRequestBodyMeasure:!0,rumReportOnce:[],rumReport:[],handledErrorPrefix:"HANDLED ERROR >>>",plugins:[],transformPipes:[],enrichmentPipes:[],storagePrefix:"paa_",logLevel:ne.Error,version:"1.79.6",detectionTimeWindow:1e3,initialDocURL:"",initiatorStorageType:"persistent"};function ct(e){if("string"!=typeof e)throw new Error("Invalid input. Input must be a string");const t=e.match(/(\/?)(.+)\1([a-z]*)/i);return t?t[3]&&!/^(?!.*?(.).*?\1)[gmixXsuUAJ]+$/.test(t[3])?RegExp(e):new RegExp(t[2],t[3]):null}function ut(e){for(const t of e)if("object"==typeof t&&Array.isArray(t.name))for(let e=0;e<t.name.length;e++){const r=t.name[e];if("string"==typeof r&&r.startsWith("/")){const n=ct(r);n instanceof RegExp&&(t.name[e]=n)}}}const lt=(new PulseModule).provide((function(a){return a.useFactory(TrackerConfigurations,(e=>e),[i]).useClass(LoggerService,LoggerService,[TrackerConfigurations]).useClass(TransientStorage,TransientStorage,[]).useValue(e,window).useClass(AnalyticsEnvironment,AnalyticsEnvironment,[e]).useClass(DateService,DateService,[AnalyticsEnvironment]).useClass(StateService,StateService,[TransientStorage]).useClass(TransportService,TransportService,[AnalyticsEnvironment]).useClass(PersistentStorage,PersistentStorage,[AnalyticsEnvironment,TrackerConfigurations]).useClass(Quote,Quote,[]).useFactory(t,((e,t)=>r=>{switch(r){case"memory":return e;case"persistent":return t}}),[TransientStorage,PersistentStorage]).useClass(DOMPath,DOMPath,[]).useClass(ActivityTracker,ActivityTracker,[DocumentVisibilityTracker,AnalyticsEnvironment]).useClass(DocumentVisibilityTracker,DocumentVisibilityTracker,[AnalyticsEnvironment]).useFactory(r,((e,t)=>e.win[t.dataLayerKey]),[AnalyticsEnvironment,TrackerConfigurations]).useFactory(n,(e=>e.win.pulse?.q),[AnalyticsEnvironment]).useClass(DataLayerService,DataLayerService,[AnalyticsEnvironment]).useClass(LocationHistoryTracker,LocationHistoryTracker,[AnalyticsEnvironment]).useClass(RUMService,RUMService,[PerformanceTimelineService,RequestMonitorService]).useFactory(ActivitySynchronizer,((e,t,r,n)=>new ActivitySynchronizer(e(t.initiatorStorageType),r,n,t)),[t,TrackerConfigurations,ActivityTracker,DateService]).useFactory(InitiatorDetector,((e,t,r,n,i)=>new InitiatorDetector(e(t.initiatorStorageType),r,n,i,t)),[t,TrackerConfigurations,ActivitySynchronizer,DateService,AnalyticsEnvironment]).useClass(NavigationEventService,NavigationEventService,[AnalyticsEnvironment,InitiatorDetector]).useClass(AsyncTask,AsyncTask,[]).useClass(RequestMonitorService,RequestMonitorService,[FetchCollectorService,XHRCollectorService,PerformanceTimelineService,DateService,AnalyticsEnvironment]).useClass(PerformanceTimelineService,PerformanceTimelineService,[AnalyticsEnvironment,CSSPathService,DateService,DocumentVisibilityTracker]).useClass(CSSPathService,CSSPathService,[]).useClass(FetchCollectorService,FetchCollectorService,[DateService,AnalyticsEnvironment]).useClass(XHRCollectorService,XHRCollectorService,[DateService,AnalyticsEnvironment]).useClass(NavigationEventPlugin,NavigationEventPlugin,[LocationHistoryTracker,NavigationEventService,ActivitySynchronizer]).useClass(VisibilityChangePlugin,VisibilityChangePlugin,[DocumentVisibilityTracker]).useClass(ClickEventPlugin,ClickEventPlugin,[ActivityTracker,AnalyticsEnvironment]).useClass(PopupEventPlugin,PopupEventPlugin,[ActivityTracker,AnalyticsEnvironment]).useClass(EventGlobalsPipe,EventGlobalsPipe,[AnalyticsEnvironment]).useClass(ActionParamEventPipe,ActionParamEventPipe,[]).useClass(RUMPlugin,RUMPlugin,[RUMService,AnalyticsEnvironment]).useClass(ContextMenuPlugin,ContextMenuPlugin,[ActivityTracker,AnalyticsEnvironment]).useClass(PluginHost,PluginHost,[]).useClass(s,PipeHost,[]).useClass(o,PipeHost,[]).useClass(PluginsFactory,PluginsFactory,[NavigationEventPlugin,VisibilityChangePlugin,ClickEventPlugin,PluginHost,TrackerConfigurations,PopupEventPlugin,n,RUMPlugin,ContextMenuPlugin,r]).useClass(PipesFactory,PipesFactory,[ActionParamEventPipe,EventGlobalsPipe,s,o,TrackerConfigurations]).useFactory(PulseTracker,((e,t,r,n,i,o,s,a,c,u)=>{a.registerPipes(),c.registerPlugins();return new PulseTracker(e,t,r,n,o,s,i,u)}),[PluginHost,s,o,LoggerService,StateService,DateService,TrackerConfigurations,PipesFactory,PluginsFactory,TransportService])})).beforeInit((function(e){const t={...at,...e,initialDocURL:window.paa?.idu};return function(e){e.rumReport=e.rumReport||[],e.rumReportOnce=e.rumReportOnce||[],ut(e.rumReport),ut(e.rumReportOnce)}(t),t}));const pt=window,ht=pt.pulseReady||[];pt.pulseReady=ht;const dt=ht.push.bind(ht);ht.push=function(...e){for(const t of e)dt(t);return ht.length};const ft=window,vt={"app":"picsart.com","storagePrefix":"paa_","batchTimeMS":500,"batchSize":50,"settingsBaseURL":"https://stage.optifyr.com/web/v2","debug":["debugger"],"rumReport":[],"rumReportOnce":[],"consentChecks":[{"type":"tracking","consent":"OneTrust","report":true,"mode":"opt-out","forceReport":true}]};ft.pulse=function(e,t){if(e.pulse){if(1!==e.pulse._v)throw new Error("You can't load different versions of the Pulse SDK in a single page!");return e.pulse}function r(){r.q.push(arguments)}return e.pulseReady=e.pulseReady||[],e.dataLayer=e.dataLayer||[],r.c=t||{},r.q=[],r.idu=e.location.href,e.pulse=r,e.pulse._v=1,r}(ft,vt),ft.pulse.init=async function(e,t,r,n){const i=ft?.pulse;if(!i)throw new Error("Window.Pulse is not defined!");const o=i.initTask??async function(e,t,r,n){if(ft.pulse&&(ft.pulse._transport=r,ft.pulse._route=n,ft.pulse._attributes=t),ft?.pulse?._initialized&&ft?.pulse?.tracker)return ft.pulse.tracker;const i={...ft.pulse?.c||{}||{},...e||{}},o=await(new PulseModule).import(lt).bootstrap(i),s=await o.get(PulseTracker);return ft.pulse.tracker=s,ft.pulse._initialized=!0,{tracker:s}}({...vt,...e},t,r,n);return i.initTask=o,await o,o},function(){for(const e of ht)ht.splice(ht.indexOf(e),1),e.onReady()}()})();
//# sourceMappingURL=pulse.bundle.mini.esnext.b4bc7b857f112b1d.js.map